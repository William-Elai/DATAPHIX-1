<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dataphix Stationery & Tech Hub</title>
    <link rel="icon" type="jpg" href="/dataphix.jpg"

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://kit.fontawesome.com/a2e0d5c6f0.js" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root{
            --bg-main: #141b21; 
            --bg-card: #1f2730; 
            --text-primary: #e6eef6;
            --accent-a: #00bcd4; 
            --accent-b: #8bc34a; 
        }
        html,body { 
            height:100%; 
            margin:0; 
            font-family:Inter, ui-sans-serif, system-ui; 
            color:var(--text-primary); 
            background:var(--bg-main); 
        }
        .glass { 
            background: var(--bg-card); 
            border-radius:1rem; 
            padding:1rem; 
            border: 10px solid rgba(255,255,255,0.05); 
        }
        .accent-gradient { 
            background: linear-gradient(90deg,var(--accent-a),var(--accent-b)); 
            -webkit-background-clip:text; 
            color:transparent; 
        }
        .card-glow { 
            box-shadow: 0 4px 15px rgba(0,0,0,0.4); 
            transition: transform .25s, box-shadow .25s; 
        }
        .card-glow:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(0,0,0,0.6), 0 0 15px var(--accent-a);
        }
        .btn { 
            background: linear-gradient(90deg,var(--accent-a),var(--accent-b)); 
            color:black; 
            padding:0.65rem 1.5rem; 
            border:none; 
            border-radius:0.5rem; 
            cursor:pointer; 
            font-weight:700; 
            display:inline-flex; 
            align-items:center; 
            gap:0.5rem;
            transition: opacity 0.2s;
        }
        .btn:hover {
            opacity: 0.5;
        }
        
        /* Form/Input Styling */
        input:not([type="radio"]):not([type="checkbox"]), select {
            width: 100%;
            padding: 0.5rem;
            margin-top: 0.25rem;
            background-color: #2e3743;
            border: 1px solid #4a5568;
            border-radius: 0.375rem;
            color: var(--text-primary);
        }
        .radio-group label {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border: 1px solid #4a5568;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .radio-group input[type="radio"]:checked + label {
            border-color: var(--accent-a);
            background-color: rgba(0, 188, 212, 0.1);
        }
        .radio-group input[type="radio"] {
            margin-right: 0.5rem;
        }

        /* Invoice/Modal Styling */
        #invoiceContainer {
            background-color: white; 
            color: #1f2730; 
            max-width: 450px;
            width: 90%;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        #invoiceContainer h2 {
            color: #00bcd4;
        }
        #invoiceItemsTable th, #invoiceItemsTable td {
            padding: 8px 0;
            border-bottom: 1px dashed #ccc;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-50">
<style>
    header {
      background: url('456.jpg') 
      no-repeat center center/cover;
      position: relative;
    }
    
    header::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6); /* adds overlay for readability */
      backdrop-filter: blur(6px);
      z-index: 0;
    }

    header > * {
      position: relative;
      z-index: 1;
    }

</style>
        <div class="px-5 py-4 max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <img src="custom-logo.png" alt="Dataphix Logo" class="w-12 h-12 rounded-xl" />
                <div class="text-xl font-bold accent-gradient">Dataphix Hub</div>
            </div>

            <div class="flex items-center gap-4">
                <select id="currencySelect" class="rounded px-2 py-1 text-sm bg-gray-800 border border-gray-700 text-gray-200">
                    <option value="UGX" selected>UGX</option>
                    <option value="USD">USD</option>
                </select>
                <button id="openCartBtn" class="btn text-sm">
                    <i class="fa fa-shopping-cart"></i>
                    Cart <span id="topCartCount" class="ml-2 inline-block w-6 text-center bg-black text-white rounded-full">0</span>
                </button>
            </div>
        </div>
    </header>

    <main class="pb-16 max-w-7xl mx-auto px-5">
        <div class="py-12 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold accent-gradient mb-3">Welcome to the Tech Hub</h1>
            <p class="max-w-3xl mx-auto text-gray-400 text-lg">
                Your destination for cutting-edge tech and essential stationery services. âš¡
            </p>
        </div>

        <section id="shop" class="py-10">
            <h2 class="text-2xl font-bold mb-6">Latest Tech Products</h2>
            <div id="productGrid" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </section>

        <section id="services" class="py-10">
            <h2 class="text-2xl font-bold mb-6">Printing & Stationery Services</h2>
            <div class="glass p-4 overflow-x-auto">
                <table>
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Pages / Qty</th>
                            <th>Price (UGX)</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="servicesTable"></tbody>
                </table>
            </div>
        </section>
    </main>

    <footer class="bg-gray-900 border-t border-gray-800 mt-10 py-8">
        <div class="max-w-7xl mx-auto px-5">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                
                <div>
                    <div class="flex items-center justify-center md:justify-start mb-3">
                        <img src="dataphix.jpg" alt="Dataphix Logo" class="w-10 h-10 rounded mr-3">
                        <div class="text-2xl font-bold accent-gradient">Dataphix Hub</div>
                    </div>
                    <p class="text-sm text-gray-400">
                        Your Stationery & Tech Partner in Kampala.
                    </p>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-white mb-3">Get in Touch</h3>
                    <p class="text-gray-300 flex items-center justify-center md:justify-start mb-2">
                        <i class="fa fa-envelope mr-3 text-cyan-400"></i> 
                        <a href="mailto:info@dataphixhub.com" class="hover:text-cyan-400">info@dataphixhub.com</a>
                    </p>
                    <p class="text-gray-300 flex items-center justify-center md:justify-start">
                        <i class="fa fa-phone mr-3 text-lime-400"></i> 
                        <a href="tel:+256700123456" class="hover:text-lime-400">+256 700 123 456</a>
                    </p>
                </div>

                <div class="md:text-right">
                    <h3 class="text-lg font-semibold text-white mb-3">Location</h3>
                    <p class="text-sm text-gray-400 mb-4">
                        Acacia Avenue, Kampala, Uganda
                    </p>
                    <p class="text-xs text-gray-500">
                        &copy; 2025 Dataphix Hub. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <div id="cartModal" class="fixed inset-0 bg-black/70 flex items-center justify-center hidden z-50 transition-opacity duration-300">
        <div class="glass p-6 rounded-2xl w-11/12 sm:w-96 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Your Cart</h3>
                <button id="closeCart" class="text-gray-400 hover:text-white"><i class="fa fa-times text-xl"></i></button>
            </div>
            <ul id="cartItems" class="space-y-3 mt-2 divide-y divide-gray-800"></ul>
            <div class="mt-6 flex justify-between font-extrabold text-xl border-t border-gray-700 pt-4">
                <span>TOTAL:</span> <span id="cartTotal" class="accent-gradient">UGX 0</span>
            </div>
            <div class="mt-6 grid gap-3">
                <button id="checkoutBtn" class="btn w-full">Proceed to Checkout</button> 
                <button id="clearCartBtn" class="bg-red-700 text-white py-2 rounded-lg font-semibold hover:bg-red-600">Clear Cart</button>
            </div>
        </div>
    </div>

    <div id="orderFormModal" class="hidden fixed inset-0 bg-black/80 flex justify-center items-center z-50">
        <div class="glass p-6 rounded-2xl w-11/12 md:w-[600px] max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-3">
                <h3 class="text-2xl font-bold accent-gradient">Complete Your Order</h3>
                <button id="closeOrderForm" class="text-gray-400 hover:text-white"><i class="fa fa-times text-xl"></i></button>
            </div>

            <form id="orderForm" class="space-y-6">
                
                <div class="space-y-2">
                    <label class="block text-lg font-semibold text-white">1. Delivery or Pickup? <span class="text-red-500">*</span></label>
                    <div class="radio-group grid grid-cols-2 gap-3">
                        <div>
                            <input type="radio" id="delivery" name="deliveryType" value="Delivery" required checked>
                            <label for="delivery" class="hover:border-cyan-400">
                                <i class="fa fa-truck mr-2 text-cyan-400"></i> Delivery (Shipping Fees Apply)
                            </label>
                        </div>
                        <div>
                            <input type="radio" id="pickup" name="deliveryType" value="Pickup" required>
                            <label for="pickup" class="hover:border-lime-400">
                                <i class="fa fa-store mr-2 text-lime-400"></i> Store Pickup (Free)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="block text-lg font-semibold text-white">2. Preferred Payment Method <span class="text-red-500">*</span></label>
                    <div class="radio-group grid grid-cols-2 gap-3">
                        <div>
                            <input type="radio" id="mobileMoney" name="paymentType" value="Mobile Money" required checked>
                            <label for="mobileMoney" class="hover:border-cyan-400">
                                <i class="fa fa-mobile-alt mr-2 text-cyan-400"></i> Mobile Money (M-Pesa/Airtel)
                            </label>
                        </div>
                        <div>
                            <input type="radio" id="cash" name="paymentType" value="Cash" required>
                            <label for="cash" class="hover:border-lime-400">
                                <i class="fa fa-money-bill-wave mr-2 text-lime-400"></i> Cash on Delivery/Pickup
                            </label>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <label class="block text-lg font-semibold text-white">3. Your Contact & Shipping Details</label>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-400">Full Name <span class="text-red-500">*</span></label>
                            <input type="text" id="name" name="name" required placeholder="John Doe">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-400">Email Address</label>
                            <input type="email" id="email" name="email" placeholder="john@example.com">
                        </div>
                    </div>
                    <div>
                        <label for="contact" class="block text-sm font-medium text-gray-400">Contact Number <span class="text-red-500">*</span></label>
                        <input type="tel" id="contact" name="contact" required placeholder="+256 7XX XXX XXX">
                    </div>
                    <div id="addressFieldContainer">
                        <label for="address" class="block text-sm font-medium text-gray-400">Delivery Address <span class="text-red-500">*</span></label>
                        <input type="text" id="address" name="address" required placeholder="Plot No., Street, Area">
                    </div>
                </div>

                <button type="submit" class="btn w-full mt-6 text-lg">
                    <i class="fa fa-receipt"></i> Confirm Order & Generate Invoice
                </button>
            </form>
        </div>
    </div>
    
    <div id="invoiceModal" class="hidden fixed inset-0 bg-black/80 flex justify-center items-center z-50">
        <div id="invoiceContainer" class="p-8">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-extrabold mb-1">DATAPHIX HUB</h2>
                <p class="text-sm text-gray-600">Stationery & Tech Solutions</p>
                <p class="text-xs text-gray-500 mt-2">Acacia Ave, Kampala | Tel: +256 700 123456</p>
            </div>
            
            <hr class="border-gray-300 mb-4">
            
            <div class="flex justify-between text-sm mb-4 font-semibold">
                <p id="invoiceNumber" class="text-sm">Invoice #: DPX-0001</p>
                <p id="invoiceDate" class="text-sm">Date: </p>
            </div>

            <div id="customerInfo" class="text-xs text-gray-700 mb-4 border-b border-gray-300 pb-2">
                </div>

            <div class="overflow-x-auto mb-4">
                <table id="invoiceItemsTable" class="w-full text-sm">
                    <thead>
                        <tr class="border-b-2 border-gray-400">
                            <th class="text-left font-bold w-3/5">Item / Description</th>
                            <th class="text-center font-bold w-1/5">Qty</th>
                            <th class="text-right font-bold w-1/5">Total Price</th>
                        </tr>
                    </thead>
                    <tbody id="invoiceItems">
                        </tbody>
                </table>
            </div>
            
            <div class="mt-4 pt-2 border-t border-gray-500 space-y-1">
                <div class="flex justify-between font-bold text-base">
                    <span>Order Type:</span> <span id="invoiceDeliveryType" class="font-normal">Pickup</span>
                </div>
                <div class="flex justify-between font-bold text-lg">
                    <span>TOTAL DUE:</span> <span id="invoiceTotal" class="text-green-600"></span>
                </div>
            </div>
            
            <p class="text-xs text-center text-gray-500 mt-6">Thank you for your patronage!</p>

            <div class="mt-6 flex flex-wrap gap-3 justify-center">
                <button id="downloadInvoicePdf" class="btn bg-red-600 hover:bg-red-500 text-white !px-3 !py-2 !text-sm !font-semibold !gap-2">
                    <i class="fa fa-file-pdf"></i> Download PDF
                </button>
                <button id="printInvoice" class="btn bg-gray-500 hover:bg-gray-400 text-white !px-3 !py-2 !text-sm !font-semibold !gap-2">
                    <i class="fa fa-print"></i> Print View
                </button>
                <button onclick="closeInvoice()" class="bg-gray-300 text-gray-800 px-3 py-2 rounded-lg font-semibold hover:bg-gray-400 !text-sm">Close</button>
            </div>
        </div>
    </div>

    <script>

        const services = [
            {name:'Normal B/W Printing (per page)', price:500, hasPages: true},
            {name:'Normal Color Printing (per page)', price:1000, hasPages: true},
            {name:'Poster/Flyer Design', price:10000, hasPages: false},
            {name:'Certificate Paper Print', price:2500, hasPages: false},
            {name:'Paper / photo frame with glass', price:15000, hasPages: false},
            {name:'Photo board wood (per paper)', price:25000, hasPages: false},
            {name:'Passport Photos (4 pcs)', price:5000, hasPages: false},
            {name:'ID Plastic Copy (hard)', price:10000, hasPages: false},
            {name:'Sealing documents (per paper)', price:2000, hasPapers: true},
            {name:'Phone Flashing / Unlocking', price:30000, hasPages: false},
            {name:'Professional Website buuilding', price:800000, haspages: false}
        ];
        
        const products = [
            {id:1,name:'MacBook Pro M2',price:4500000,img:'https://www.notebookcheck.net/fileadmin/_processed_/b/1/csm_teaser_87a40a99d2.jpg'}, 
            {id:2,name:'HP Spectre x360',price:3800000,img:'https://www.notebookcheck.net/fileadmin/Notebooks/News/_nc3/6301163cv11d.jpg'}, 
            {id:3,name:'Lenovo ThinkPad X1',price:4000000,img:'https://platform.theverge.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/12565107/vpavic_180712_2898_thinkpad_0003.jpg?quality=90&strip=all&crop=0%2C0%2C100%2C100&w=750'},
            {id:4,name:'Chromebook Pixel',price:2800000,img:'https://cdn.mos.cms.futurecdn.net/LowqpvfEXKTLwcZXQBmTe3-650-80.jpg.webp'}, 
            {id:5,name:'Huawei MateBook 14',price:3500000,img:'https://consumer.huawei.com/content/dam/huawei-cbg-site/common/mkt/pdp/pc/matebook-14-2024/images/huawei-matebook-14-2024-top-feactures1.webp'}, 
            {id:6,name:'iPhone 17 pro',price:3200000,img:'https://cinem8.co/cdn/shop/files/iphone-17-pro-wallpaper-hd-4k-cosmic-orange.jpg?v=1758036888&width=1200'}, 
            {id:7,name:'Samsung Galaxy S25',price:2800000,img:'https://fdn2.gsmarena.com/vv/pics/samsung/samsung-galaxy-s25-ultra-sm-s938-1.jpg'}, 
            {id:8,name:'Huawei P60',price:2700000,img:'https://cdn.mos.cms.futurecdn.net/NL9dhymwBDJoNsoRC2Lvw9-650-80.jpg.webp'}, 
            {id:9,name:'Tecno Phantom X',price:1500000,img:'https://cdn1.smartprix.com/rx-iMTcigfAF-w420-h420/tecno-phantom-x4.webp'}, 
            {id:10,name:'Sony Xperia 1 V',price:2800000,img:'https://www.dpreview.com/files/p/articles/0915415837/sony-xperia-iv-live-lead-image.jpeg'} 
        ];
        // Global State
        let cart = [];
        let invoiceCount = 1;
        let customerOrderDetails = {}; // Stores form data

        // --- Utility Functions ---

        function formatCurrency(amount) {
            return `UGX ${amount.toLocaleString()}`;
        }

        function renderProducts(){
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'glass card-glow p-4 flex flex-col justify-between';
                card.innerHTML = `
                    <img src="${p.img}" alt="${p.name}" class="w-full h-40 object-cover rounded-lg mb-4">
                    <div>
                        <h3 class="font-semibold text-white text-lg">${p.name}</h3>
                        <p class="mt-1 font-bold text-lime-400 text-xl">${formatCurrency(p.price)}</p>
                    </div>
                    <button class="mt-4 w-full btn" data-id="${p.id}" data-type="product">
                        <i class="fa fa-plus"></i> Add to Cart
                    </button>
                `;
                grid.appendChild(card);
            });
            grid.querySelectorAll('button[data-type="product"]').forEach(btn=>{
                btn.addEventListener('click', ()=> addToCart('product', Number(btn.dataset.id)));
            });
        }

        function renderServices(){
            const tbody = document.getElementById('servicesTable');
            tbody.innerHTML = '';
            services.forEach((s, idx)=>{
                const isVariable = s.hasPages; 
                const defaultPages = 1;

                const row = document.createElement('tr');
                row.className = 'border-b border-gray-800 last:border-b-0';
                row.innerHTML = `
                    <td>${s.name.replace(' (per page)', '').replace(' (4 pcs)', '')}</td>
                    <td>
                        ${isVariable ? 
                            `<input type="number" min="1" value="${defaultPages}" class="service-pages w-16 text-center" data-idx="${idx}">` : 
                            '<span class="text-gray-400">-</span>'}
                    </td>
                    <td class="service-price" data-idx="${idx}">${formatCurrency(s.price*defaultPages)}</td>
                    <td><button class="btn !px-3 !py-1 !text-sm" data-type="service" data-idx="${idx}">Add</button></td>
                `;
                tbody.appendChild(row);
            });

            tbody.querySelectorAll('input.service-pages').forEach(input=>{
                input.addEventListener('change', (e)=>{
                    let pages = Number(e.target.value);
                    if (pages < 1 || isNaN(pages)) pages = 1;
                    e.target.value = pages;
                    const idx = Number(input.dataset.idx);
                    document.querySelector(`.service-price[data-idx="${idx}"]`).textContent = formatCurrency(services[idx].price*pages);
                });
            });

            tbody.querySelectorAll('button[data-type="service"]').forEach(btn=>{
                btn.addEventListener('click', ()=>{
                    const idx = Number(btn.dataset.idx);
                    let pages = 1;
                    const pagesInput = document.querySelector(`input.service-pages[data-idx="${idx}"]`);
                    if(pagesInput) {
                        pages = Number(pagesInput.value)||1;
                    }
                    addToCart('service', idx, pages);
                });
            });
        }

        function addToCart(type, id, pages = 1){
            let item;
            if(type === 'product'){
                const prod = products.find(p => p.id === id);
                if(!prod) return;
                item = {kind:'product', name:prod.name, price:prod.price, qty: 1};
                cart.push(item);

            } else if(type === 'service'){
                const base = services[id];
                const price = base.price * pages;
                
                const existingItem = cart.find(c => c.kind === 'service' && c.name === base.name);

                if (existingItem) {
                    existingItem.qty += pages;
                    existingItem.price += price;
                } else {
                    item = {kind:'service', name:base.name, price:price, qty: pages, unitPrice: base.price};
                    cart.push(item);
                }
            }
            updateCartUI();
        }

        function updateCartUI(){
            const list = document.getElementById('cartItems');
            list.innerHTML='';
            let total=0;

            cart.forEach((item,idx)=>{
                const li = document.createElement('li');
                li.className='flex justify-between items-center py-2';
                
                const itemQtyDisplay = item.qty > 1 ? ` (x${item.qty})` : '';
                
                li.innerHTML = `
                    <span class="text-sm">${item.name.replace(' (per page)', '').replace(' (4 pcs)', '')}${itemQtyDisplay}</span>
                    <div class="flex items-center gap-3">
                        <span class="font-semibold text-sm">${formatCurrency(item.price)}</span>
                        <button class="text-red-500 hover:text-red-400" data-idx="${idx}" title="Remove"><i class="fa fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(li);
            });
            
            list.querySelectorAll('button').forEach(btn=>{
                btn.addEventListener('click', (e)=> {
                    const idx = Number(e.currentTarget.dataset.idx);
                    cart.splice(idx,1);
                    updateCartUI();
                });
            });

            total = cart.reduce((a,b)=>a+b.price,0);
            document.getElementById('cartTotal').textContent = formatCurrency(total);
            document.getElementById('topCartCount').textContent = cart.length;
        }

        function generateInvoice(){
            const number = `DPX-${invoiceCount.toString().padStart(4,'0')}`;
            const date = new Date().toLocaleDateString('en-GB', {day: '2-digit', month: 'short', year: 'numeric'});
            
            document.getElementById('invoiceNumber').textContent = `Invoice #: ${number}`;
            document.getElementById('invoiceDate').textContent = `Date: ${date}`;
            
            // Populate Customer Details
            const customerHtml = `
                <p><strong>Customer:</strong> ${customerOrderDetails.name}</p>
                <p><strong>Contact:</strong> ${customerOrderDetails.contact} ${customerOrderDetails.email ? `(${customerOrderDetails.email})` : ''}</p>
                <p><strong>Method:</strong> ${customerOrderDetails.paymentType}</p>
                ${customerOrderDetails.deliveryType === 'Delivery' ? 
                    `<p><strong>Ship To:</strong> ${customerOrderDetails.address}</p>` : 
                    `<p><strong>Pickup Location:</strong> Acacia Avenue, Kampala</p>`
                }
            `;
            document.getElementById('customerInfo').innerHTML = customerHtml;
            document.getElementById('invoiceDeliveryType').textContent = customerOrderDetails.deliveryType;

            const container = document.getElementById('invoiceItems');
            container.innerHTML='';
            let total=0;

            cart.forEach(item=>{
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-300';
                
                const itemName = item.name.replace(' (per page)', '').replace(' (4 pcs)', '');
                
                row.innerHTML = `
                    <td>${itemName}</td>
                    <td class="text-center">${item.qty}</td>
                    <td class="text-right">${formatCurrency(item.price)}</td>
                `;
                container.appendChild(row);
                total+=item.price;
            });

            document.getElementById('invoiceTotal').textContent = formatCurrency(total);
            invoiceCount++;

            // Open Invoice Modal
            document.getElementById('invoiceModal').classList.remove('hidden');
        }

        // --- MODAL & BUTTON LISTENERS ---

        document.getElementById('openCartBtn').addEventListener('click', ()=> document.getElementById('cartModal').classList.remove('hidden'));
        document.getElementById('closeCart').addEventListener('click', ()=> document.getElementById('cartModal').classList.add('hidden'));
        document.getElementById('closeOrderForm').addEventListener('click', ()=> document.getElementById('orderFormModal').classList.add('hidden'));
        
        document.getElementById('clearCartBtn').addEventListener('click', ()=>{
            cart=[]; updateCartUI();
        });

        // Checkout Button now opens the ORDER FORM
        document.getElementById('checkoutBtn').addEventListener('click', ()=>{
            if(cart.length===0){ 
                alert('Your cart is empty. Please add items to proceed.'); 
                return;
            }
            document.getElementById('cartModal').classList.add('hidden');
            document.getElementById('orderFormModal').classList.remove('hidden');
        });

        function closeInvoice(){ 
            document.getElementById('invoiceModal').classList.add('hidden'); 
            cart=[]; 
            updateCartUI(); 
        }

        // --- ORDER FORM SUBMISSION ---
        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            customerOrderDetails = {
                name: form.name.value,
                email: form.email.value,
                contact: form.contact.value,
                deliveryType: form.deliveryType.value,
                paymentType: form.paymentType.value,
                address: form.address ? form.address.value : 'N/A'
            };

            // Close form and generate invoice
            document.getElementById('orderFormModal').classList.add('hidden');
            generateInvoice();
        });

        // --- Conditional Address Field ---
        const deliveryRadios = document.querySelectorAll('input[name="deliveryType"]');
        const addressContainer = document.getElementById('addressFieldContainer');
        const addressInput = document.getElementById('address');

        deliveryRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'Delivery') {
                    addressContainer.style.display = 'block';
                    addressInput.required = true;
                } else {
                    addressContainer.style.display = 'none';
                    addressInput.required = false;
                }
            });
        });
        // Initial state check
        if (document.getElementById('pickup').checked) {
            addressContainer.style.display = 'none';
            addressInput.required = false;
        }

        
        // --- DOWNLOAD PDF FUNCTION (jsPDF) ---
        document.getElementById('downloadInvoicePdf').addEventListener('click', ()=>{
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let y = 10;
            const lineHeight = 6;
            
            const total = cart.reduce((a,b)=>a+b.price,0);
            const invoiceNum = document.getElementById('invoiceNumber').textContent;
            const invoiceDt = document.getElementById('invoiceDate').textContent;
            const totalDisplay = formatCurrency(total);
            
            // Set Font and Colors for Professional Look
            doc.setTextColor(31, 39, 48); // Dark Text
            doc.setFontSize(20);
            doc.text("DATAPHIX HUB", 105, y, null, null, "center");
            y += lineHeight;
            doc.setFontSize(10);
            doc.text("Stationery & Tech Solutions", 105, y, null, null, "center");
            y += lineHeight * 0.7;
            doc.text("Acacia Ave, Kampala | Tel: +256 700 123456", 105, y, null, null, "center");
            y += lineHeight;
            doc.line(10, y, 200, y); // Horizontal line
            y += lineHeight;

            // Invoice Details
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text(invoiceNum, 10, y);
            doc.text(invoiceDt, 200, y, null, null, "right");
            y += lineHeight * 1.5;

            // Customer Info Block
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Customer: ${customerOrderDetails.name}`, 10, y);
            y += lineHeight * 0.8;
            doc.text(`Contact: ${customerOrderDetails.contact} ${customerOrderDetails.email ? `(${customerOrderDetails.email})` : ''}`, 10, y);
            y += lineHeight * 0.8;
            doc.text(`Method: ${customerOrderDetails.paymentType}`, 10, y);
            y += lineHeight * 0.8;
            doc.text(`Delivery Type: ${customerOrderDetails.deliveryType}`, 10, y);
            y += lineHeight * 0.8;
            if (customerOrderDetails.deliveryType === 'Delivery') {
                doc.text(`Ship To: ${customerOrderDetails.address}`, 10, y);
                y += lineHeight * 0.8;
            } else {
                doc.text(`Pickup Location: Acacia Avenue, Kampala`, 10, y);
                y += lineHeight * 0.8;
            }
            doc.line(10, y, 200, y, 'dashed'); // Separator
            y += lineHeight * 1.5;


            // Items Table Header
            doc.setFontSize(10);
            doc.setFillColor(240, 240, 240); // Light gray background for header
            doc.rect(10, y-5, 190, 6, "F"); 
            doc.text("ITEM / DESCRIPTION", 12, y);
            doc.text("QTY", 140, y, null, null, "center");
            doc.text("TOTAL PRICE", 200, y, null, null, "right");
            y += lineHeight;
            doc.setFont(undefined, 'normal');
            
            // Items
            cart.forEach(item => {
                const itemName = item.name.replace(' (per page)', '').replace(' (4 pcs)', '');
                
                doc.text(itemName, 12, y);
                doc.text(item.qty.toString(), 140, y, null, null, "center");
                doc.text(formatCurrency(item.price), 200, y, null, null, "right");
                y += lineHeight;
            });
            
            y += lineHeight;
            doc.line(10, y, 200, y); // Separator
            y += lineHeight * 0.5;

            // Totals
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text("TOTAL DUE:", 150, y, null, null, "right");
            doc.text(totalDisplay, 200, y, null, null, "right");
            y += lineHeight * 2;
            
            // Footer
            doc.setFontSize(10);
            doc.setFont(undefined, 'italic');
            doc.text("Thank you for your patronage!", 105, y, null, null, "center");

            doc.save(`Dataphix_Invoice_${invoiceNum.split('#: ')[1]}.pdf`);
        });

        // --- PRINT VIEW FUNCTION ---
        document.getElementById('printInvoice').addEventListener('click', ()=>{
            const printContent = document.getElementById('invoiceContainer').cloneNode(true);
            // Remove buttons from the cloned content
            printContent.querySelector('.flex.flex-wrap.gap-3.justify-center').remove();
            
            // Apply essential print styles
            const win = window.open('', 'Print', 'height=600,width=800');
            win.document.write('<html><head><title>Invoice</title><style>');
            win.document.write(`
                @media print {
                    body { margin: 0; padding: 0; }
                    #invoiceContainer { width: 100%; box-shadow: none; border: none; margin: 0; }
                    #invoiceContainer h2 { color: #00bcd4 !important; -webkit-print-color-adjust: exact; color-adjust: exact; }
                    #invoiceItemsTable th, #invoiceItemsTable td { border-bottom: 1px dashed #ccc; padding: 8px 0; }
                    #customerInfo { font-size: 10px; color: #555 !important; border-bottom: 1px solid #ccc !important; }
                    #invoiceTotal { color: #10b981 !important; } /* Green */
                }
            `);
            win.document.write('</style></head><body>');
            win.document.write(printContent.outerHTML);
            win.document.write('</body></html>');
            win.document.close();
            win.print();
        });

        // Initial rendering
        renderProducts();
        renderServices();
    </script>
</body>
</html>
