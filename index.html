<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dataphix Stationery & Tech Hub</title>
  <meta name="description" content="Dataphix â€” Stationery, Internet CafÃ©, Tech Hub & POS â€” printing, programming, gadgets, invoices and bookings." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg-1: #0b0f14;
      --glass: rgba(255,255,255,0.03);
      --accent-a: #00bcd4; /* cyan */
      --accent-b: #8bc34a; /* lime */
      --accent-c: #ff77d0; /* pink */
    }
    html,body{height:100%}
    body{background:radial-gradient(circle at 10% 10%, rgba(0,188,212,0.04), transparent 10%), radial-gradient(circle at 90% 90%, rgba(139,195,74,0.03), transparent 20%), var(--bg-1); color:#e6eef6}
    .glass{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); backdrop-filter:blur(6px);}
    .accent-gradient{background:linear-gradient(90deg,var(--accent-a),var(--accent-b)); -webkit-background-clip:text; color:transparent}
    .card-glow{box-shadow:0 8px 30px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02)}
    .pulse {animation: pulse 2.6s infinite}
    @keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.03);opacity:.86}100%{transform:scale(1);opacity:1}}
    .float-btn{position:fixed;right:22px;bottom:22px;z-index:60}
    .tech-badge{background:linear-gradient(90deg,var(--accent-c),var(--accent-a));-webkit-background-clip:text;color:transparent}
    /* small responsive tweaks */
    @media (max-width:640px){ .desktop-hide{display:none} }
  </style>
</head>
<body class="antialiased font-sans leading-relaxed">
  <!-- HEADER -->
  <header class="glass border-b border-gray-800 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-5 py-4 flex items-center justify-between">
      <a href="#home" class="flex items-center gap-3">
        <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-sky-500 to-lime-400 flex items-center justify-center text-black font-extrabold">DS</div>
        <div>
          <div class="text-sm font-semibold">Dataphix</div>
          <div class="text-xs text-gray-400">Stationery â€¢ Internet â€¢ Tech Hub</div>
        </div>
      </a>
      <nav class="hidden md:flex gap-6 items-center text-gray-200">
        <a href="#services" class="hover:text-white">Services</a>
        <a href="#shop" class="hover:text-white">Tech Shop</a>
        <a href="#pricing" class="hover:text-white">Pricing</a>
        <a href="#contact" class="hover:text-white">Contact</a>
      </nav>
      <div class="flex items-center gap-3">
        <div class="text-sm text-gray-300">UGX</div>
        <select id="currencySelect" class="bg-transparent border border-gray-800 p-2 rounded text-sm text-gray-200">
          <option value="UGX" selected>UGX</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="KES">KES</option>
        </select>
        <button id="openCartBtn" class="px-3 py-2 rounded bg-gradient-to-r from-sky-400 to-lime-400 text-black font-semibold">Cart <span id="topCartCount" class="ml-2 inline-block w-5 text-center bg-white text-black rounded">0</span></button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section id="home" class="max-w-7xl mx-auto px-5 py-14 grid lg:grid-cols-2 gap-8 items-center">
    <div>
      <h1 class="text-4xl md:text-5xl font-extrabold">Dataphix <span class="accent-gradient">Stationery & Tech Hub</span></h1>
      <p class="mt-4 text-gray-300 max-w-xl">Printing, programming, browsing, and the nicest selection of gadgets in Kampala â€” clean, fast, and friendly for people of all ages.</p>
      <div class="mt-6 flex gap-3">
        <a href="#services" class="px-4 py-2 rounded-xl bg-gradient-to-r from-sky-400 to-lime-400 text-black font-semibold shadow-md">Explore Services</a>
        <button id="openBilling" class="px-4 py-2 rounded-xl glass border border-gray-800">Open Billing</button>
      </div>
      <div class="mt-6 flex gap-3 text-sm text-gray-400">
        <div class="p-2 rounded bg-gray-800">Open: Monâ€“Sat</div>
        <div class="p-2 rounded bg-gray-800">Free Wiâ€‘Fi</div>
        <div class="p-2 rounded bg-gray-800">Pickup & Delivery</div>
      </div>
    </div>
    <div class="rounded-2xl card-glow glass p-6">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-md text-gray-300">Featured Deal</div>
          <div class="text-2xl font-bold">Samsung Galaxy A34 â€¢ UGX 1,200,000</div>
          <div class="text-sm text-gray-400">Limited time â€” free pairing & setup.</div>
        </div>
        <img src="https://dummyimage.com/120x120/222/fff&text=Phone" alt="phone" class="w-28 h-28 rounded-lg object-cover" />
      </div>
    </div>
  </section>

  <!-- SERVICES -->
  <section id="services" class="max-w-7xl mx-auto px-5 py-10">
    <h2 class="text-2xl font-bold mb-4">Services</h2>
    <div class="grid md:grid-cols-3 gap-6">
      <div class="p-5 rounded-2xl glass card-glow">
        <h3 class="font-semibold text-cyan-300">Printing & Binding</h3>
        <p class="text-sm text-gray-300 mt-2">Color or B/W, duplex, lamination, binding. Quick-turn available.</p>
      </div>
      <div class="p-5 rounded-2xl glass card-glow">
        <h3 class="font-semibold text-pink-300">Programming & Support</h3>
        <p class="text-sm text-gray-300 mt-2">Debugging, websites, tutoring, remote sessions and on-premise support.</p>
      </div>
      <div class="p-5 rounded-2xl glass card-glow">
        <h3 class="font-semibold text-yellow-300">Internet & Workstations</h3>
        <p class="text-sm text-gray-300 mt-2">Hourly access, fast Wiâ€‘Fi, printing queue and secure storage advice.</p>
      </div>
    </div>
  </section>

  <!-- TECH SHOP -->
  <section id="shop" class="max-w-7xl mx-auto px-5 py-10">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold">Tech Hub â€” Gadgets</h2>
      <div class="flex items-center gap-3">
        <input id="shopSearch" placeholder="Search gadgets" class="p-2 rounded bg-gray-800 text-gray-200" />
        <select id="categoryFilter" class="p-2 rounded bg-gray-800 text-gray-200">
          <option value="all">All</option>
          <option value="phones">Smartphones</option>
          <option value="laptops">Laptops</option>
          <option value="watches">Smartwatches</option>
          <option value="accessories">Accessories</option>
        </select>
      </div>
    </div>

    <div id="productGrid" class="grid sm:grid-cols-2 md:grid-cols-3 gap-6">
      <!-- product cards injected by JS -->
    </div>
  </section>

  <!-- PRICING & HIGHLIGHTS -->
  <section id="pricing" class="max-w-7xl mx-auto px-5 py-10">
    <h2 class="text-2xl font-bold mb-4">Quick Pricing</h2>
    <div class="grid md:grid-cols-3 gap-6">
      <div class="p-5 rounded-2xl glass card-glow text-center">
        <div class="text-sm text-gray-300">Printing</div>
        <div class="text-xl font-bold">UGX 500 / page</div>
      </div>
      <div class="p-5 rounded-2xl glass card-glow text-center">
        <div class="text-sm text-gray-300">Internet</div>
        <div class="text-xl font-bold">UGX 1,000 / hour</div>
      </div>
      <div class="p-5 rounded-2xl glass card-glow text-center">
        <div class="text-sm text-gray-300">Programming</div>
        <div class="text-xl font-bold">From UGX 100,000</div>
      </div>
    </div>
  </section>

  <!-- FOOTER / CONTACT -->
  <footer class="max-w-7xl mx-auto px-5 py-8">
    <div class="grid md:grid-cols-2 gap-6 items-start">
      <div>
        <h4 class="font-bold">Contact</h4>
        <p class="text-gray-300 mt-2">Email: <a href="mailto:williamelaihax@gmail.com" class="underline">williamelaihax@gmail.com</a></p>
        <p class="text-gray-400 text-sm mt-2">Address: Kampala â€” replace with your real address.</p>
      </div>
      <div class="text-sm text-gray-400">
        <div>Â© 2025 Dataphix â€¢ Built for community, learning & tech</div>
      </div>
    </div>
  </footer>

  <!-- FLOATING BILLING BUTTON -->
  <div class="float-btn">
    <button id="billingBtn" class="flex items-center gap-3 px-4 py-3 rounded-2xl bg-gradient-to-r from-sky-400 to-lime-400 text-black font-semibold shadow-lg pulse">ðŸ§¾ Open Billing</button>
  </div>

  <!-- BILLING / CART MODAL (slide-up) -->
  <div id="billingModal" class="fixed inset-0 hidden z-60 items-end justify-center">
    <div class="absolute inset-0 bg-black bg-opacity-60" id="billingOverlay"></div>
    <div class="w-full md:w-3/4 lg:w-2/3 bg-gray-900 glass border-t border-gray-800 rounded-t-2xl p-6 translate-y-0" style="backdrop-filter: blur(8px);">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-bold">Point-of-Sale â€” Dataphix</h3>
        <div class="flex items-center gap-2">
          <div class="text-sm text-gray-400">Currency:</div>
          <select id="modalCurrency" class="bg-transparent border border-gray-800 p-2 rounded text-sm text-gray-200">
            <option value="UGX">UGX</option>
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
          </select>
          <button id="closeBilling" class="px-3 py-2 rounded glass">Close</button>
        </div>
      </div>

      <div class="mt-4 grid md:grid-cols-2 gap-4">
        <div>
          <div class="mb-2 text-sm text-gray-300">Add item</div>
          <div class="grid gap-2">
            <select id="serviceOrProduct" class="p-2 rounded bg-gray-800 text-gray-200">
              <option value="service">Service</option>
              <option value="product">Product</option>
            </select>
            <div id="serviceArea">
              <select id="serviceSelect" class="p-2 rounded bg-gray-800 text-gray-200">
                <option value="printing">Printing</option>
                <option value="internet">Internet Access</option>
                <option value="programming">Programming Help</option>
                <option value="typing">Typing/Transcription</option>
              </select>
            </div>

            <div id="productArea" class="hidden">
              <select id="productSelect" class="p-2 rounded bg-gray-800 text-gray-200">
                <!-- populated by JS -->
              </select>
            </div>

            <div class="flex gap-2">
              <input id="itemQty" type="number" min="1" value="1" class="p-2 rounded bg-gray-800 text-gray-200 w-1/3" />
              <input id="itemPrice" type="number" min="0" value="0" class="p-2 rounded bg-gray-800 text-gray-200 w-2/3" />
            </div>
            <div class="flex gap-2">
              <button id="addToCart" class="px-4 py-2 rounded bg-gradient-to-r from-sky-400 to-lime-400 text-black font-semibold">Add to Cart</button>
              <button id="scanQR" class="px-4 py-2 rounded glass">Scan QR (placeholder)</button>
            </div>
          </div>
        </div>

        <div>
          <div class="mb-2 text-sm text-gray-300">Cart</div>
          <div id="cartPanel" class="max-h-64 overflow-y-auto p-3 rounded bg-gray-800 space-y-2">
            <!-- items -->
          </div>
          <div class="mt-3 flex justify-between items-center text-gray-200">
            <div>Subtotal</div>
            <div id="subtotal">UGX 0</div>
          </div>
          <div class="mt-2 flex justify-between items-center text-gray-200">
            <div>Tax (18%)</div>
            <div id="taxAmt">UGX 0</div>
          </div>
          <div class="mt-3 flex justify-between items-center font-bold text-xl">
            <div>Total</div>
            <div id="grandTotal">UGX 0</div>
          </div>

          <div class="mt-4 flex gap-2">
            <button id="checkoutBtnModal" class="px-4 py-2 rounded bg-emerald-500 text-black font-semibold">Checkout</button>
            <button id="clearCartModal" class="px-4 py-2 rounded glass">Clear</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- INVOICE PREVIEW (hidden) -->
  <div id="invoiceModal" class="fixed inset-0 hidden z-70 items-center justify-center">
    <div class="absolute inset-0 bg-black bg-opacity-60"></div>
    <div class="w-full max-w-2xl bg-gray-900 glass p-6 rounded-lg z-80 print:bg-white print:text-black" style="backdrop-filter: blur(6px);">
      <div class="flex justify-between items-start">
        <div>
          <h3 class="text-xl font-bold">Dataphix Invoice</h3>
          <div class="text-sm text-gray-400">Email: <a href="mailto:williamelaihax@gmail.com" class="underline">williamelaihax@gmail.com</a></div>
        </div>
        <div class="text-sm text-gray-400">INV-<span id="invNumber">0001</span></div>
      </div>
      <div class="mt-4" id="invoiceBody">
        <!-- invoice items go here -->
      </div>
      <div class="mt-4 flex gap-2 justify-end">
        <button id="printInvoice" class="px-4 py-2 rounded bg-gradient-to-r from-sky-400 to-lime-400 text-black">Print / Download</button>
        <button id="emailInvoice" class="px-4 py-2 rounded glass">Email (mailto)</button>
        <button id="closeInvoice" class="px-4 py-2 rounded glass">Close</button>
      </div>
    </div>
  </div>

  <script>
    // ======= Data: products & default pricing (UGX) =======
    const defaultCurrency = 'UGX';
    const taxRate = 0.18; // 18% example
    const services = {
      printing: {name:'Printing (per page)', priceUGX:500},
      internet: {name:'Internet (per hour)', priceUGX:1000},
      programming: {name:'Programming (hourly)', priceUGX:100000},
      typing: {name:'Typing / Transcription (per page)', priceUGX:500}
    };

    // sample gadget catalog (mix of real brands + placeholders)
    const products = [
      {id:'p1', sku:'SM-A34', title:'Samsung Galaxy A34', category:'phones', priceUGX:1200000, img:'https://dummyimage.com/300x200/222/fff&text=Galaxy+A34'},
      {id:'p2', sku:'IP-13', title:'Apple iPhone 13', category:'phones', priceUGX:2800000, img:'https://dummyimage.com/300x200/222/fff&text=iPhone+13'},
      {id:'p3', sku:'HPENV-14', title:'HP Envy 14', category:'laptops', priceUGX:2600000, img:'https://dummyimage.com/300x200/222/fff&text=HP+Envy+14'},
      {id:'p4', sku:'DELL-XPS', title:'Dell XPS 13', category:'laptops', priceUGX:4200000, img:'https://dummyimage.com/300x200/222/fff&text=Dell+XPS+13'},
      {id:'p5', sku:'AW-5', title:'Amazfit Smartwatch', category:'watches', priceUGX:250000, img:'https://dummyimage.com/300x200/222/fff&text=Smartwatch'},
      {id:'p6', sku:'BUDS-1', title:'Wireless Earbuds', category:'accessories', priceUGX:120000, img:'https://dummyimage.com/300x200/222/fff&text=Earbuds'},
      {id:'p7', sku:'TAB-10', title:'Generic Tablet 10"', category:'laptops', priceUGX:900000, img:'https://dummyimage.com/300x200/222/fff&text=Tablet+10"'},
      {id:'p8', sku:'PS5', title:'Sony Console (Demo)', category:'accessories', priceUGX:2500000, img:'https://dummyimage.com/300x200/222/fff&text=Console'}
    ];

    // ======= Utility: currency conversion (runtime fetch) =======
    let rates = {UGX:1};
    async function fetchRates(base='UGX'){
      try{
        // free exchangerate.host - client side call
        const res = await fetch(`https://api.exchangerate.host/latest?base=${base}`);
        const data = await res.json();
        if (data && data.rates) rates = data.rates;
      }catch(e){console.warn('Could not fetch rates; using local defaults', e); rates = {UGX:1,USD:1/3800,EUR:1/4100,KES:3};}
    }
    fetchRates('UGX');

    function convert(amountUGX, target){
      if (!rates || !rates[target]) return amountUGX; // fallback
      // rates are relative to UGX if base=UGX, else approximate
      if (rates[target] === 1) return amountUGX;
      // If rates computed with base UGX: amountUGX * rates[target] gives target currency amount
      // Some APIs may return 0 or unexpected values; handle gracefully
      const val = (amountUGX * (rates[target] || 1));
      return Math.round(val*100)/100;
    }

    // ======= Render product grid =======
    const productGrid = document.getElementById('productGrid');
    function renderProducts(list){
      productGrid.innerHTML='';
      list.forEach(p=>{
        const c = document.createElement('div');
        c.className='p-4 rounded-2xl glass card-glow flex flex-col';
        c.innerHTML = `
          <img src="${p.img}" alt="${p.title}" class="w-full h-40 object-cover rounded-lg mb-3" />
          <div class="flex-1">
            <div class="font-semibold">${p.title}</div>
            <div class="text-xs text-gray-400">SKU: ${p.sku}</div>
          </div>
          <div class="mt-3 flex items-center justify-between">
            <div class="font-bold">UGX ${p.priceUGX.toLocaleString()}</div>
            <button data-id="${p.id}" class="addProductBtn px-3 py-2 rounded bg-gradient-to-r from-sky-400 to-lime-400 text-black">Add</button>
          </div>`;
        productGrid.appendChild(c);
      });
    }
    renderProducts(products);

    // ======= Shop filters =======
    document.getElementById('shopSearch').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      renderProducts(products.filter(p=>p.title.toLowerCase().includes(q) || p.sku.toLowerCase().includes(q)));
    });
    document.getElementById('categoryFilter').addEventListener('change',(e)=>{
      const v=e.target.value;
      if (v==='all') renderProducts(products); else renderProducts(products.filter(p=>p.category===v));
    });

    // ======= Modal and cart logic =======
    const billingBtn = document.getElementById('billingBtn');
    const billingModal = document.getElementById('billingModal');
    const billingOverlay = document.getElementById('billingOverlay');
    const closeBilling = document.getElementById('closeBilling');
    const openBillingBtn = document.getElementById('openBilling');
    const cartPanel = document.getElementById('cartPanel');
    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('taxAmt');
    const grandEl = document.getElementById('grandTotal');
    const topCartCount = document.getElementById('topCartCount');
    const modalCurrency = document.getElementById('modalCurrency');

    let cart = JSON.parse(localStorage.getItem('dt_cart')||'[]');
    function saveCart(){ localStorage.setItem('dt_cart', JSON.stringify(cart)); redrawCart(); }

    function redrawCart(){
      cartPanel.innerHTML='';
      if (cart.length===0) cartPanel.innerHTML='<div class="text-gray-400 text-sm">Cart is empty</div>';
      let subtotal=0;
      cart.forEach((it,idx)=>{
        const row=document.createElement('div');
        row.className='flex items-center justify-between gap-3 bg-gray-800 p-2 rounded';
        row.innerHTML=`<div class="text-sm"><div class='font-semibold'>${it.name}</div><div class='text-xs text-gray-400'>qty: ${it.qty}</div></div><div class='flex gap-2 items-center'><div class='font-semibold'>UGX ${Math.round(it.priceUGX).toLocaleString()}</div><button data-i='${idx}' class='removeBtn px-2 py-1 rounded glass'>x</button></div>`;
        cartPanel.appendChild(row);
        subtotal += it.priceUGX;
      });
      const tax = Math.round(subtotal * taxRate);
      const total = subtotal + tax;
      subtotalEl.textContent = 'UGX ' + subtotal.toLocaleString();
      taxEl.textContent = 'UGX ' + tax.toLocaleString();
      grandEl.textContent = 'UGX ' + total.toLocaleString();
      topCartCount.textContent = cart.length;
    }
    redrawCart();

    billingBtn.addEventListener('click', ()=>{ billingModal.classList.remove('hidden'); billingModal.classList.add('flex'); });
    openBillingBtn.addEventListener('click', ()=>{ billingModal.classList.remove('hidden'); billingModal.classList.add('flex'); });
    billingOverlay.addEventListener('click', ()=>{ billingModal.classList.add('hidden'); billingModal.classList.remove('flex'); });
    closeBilling.addEventListener('click', ()=>{ billingModal.classList.add('hidden'); billingModal.classList.remove('flex'); });

    // toggle between service/product input
    document.getElementById('serviceOrProduct').addEventListener('change', (e)=>{
      if (e.target.value==='service'){ document.getElementById('serviceArea').classList.remove('hidden'); document.getElementById('productArea').classList.add('hidden'); }
      else { document.getElementById('serviceArea').classList.add('hidden'); document.getElementById('productArea').classList.remove('hidden'); }
    });

    // populate productSelect in modal
    const productSelect = document.getElementById('productSelect');
    products.forEach(p=>{ const opt = document.createElement('option'); opt.value=p.id; opt.textContent=p.title + ' â€¢ UGX ' + p.priceUGX.toLocaleString(); productSelect.appendChild(opt); });

    // when service selected, auto-fill price
    document.getElementById('serviceSelect').addEventListener('change', (e)=>{ const s = services[e.target.value]; document.getElementById('itemPrice').value = s ? s.priceUGX : 0; });
    document.getElementById('productSelect').addEventListener('change',(e)=>{ const p = products.find(x=>x.id===e.target.value); document.getElementById('itemPrice').value = p ? p.priceUGX : 0; });

    // add to cart (modal)
    document.getElementById('addToCart').addEventListener('click', ()=>{
      const mode = document.getElementById('serviceOrProduct').value;
      const qty = Math.max(1, Number(document.getElementById('itemQty').value)||1);
      const priceUGX = Math.max(0, Number(document.getElementById('itemPrice').value)||0);
      let id = 'svc-'+Date.now(); let name = 'Custom Item';
      if (mode==='service'){
        const key = document.getElementById('serviceSelect').value; const svc = services[key]; id = key; name = svc.name; }
      else { const pid = document.getElementById('productSelect').value; const p = products.find(x=>x.id===pid); id = p.id; name = p.title; }
      cart.push({id, name, qty, priceUGX}); saveCart();
    });

    // click remove on cart
    document.addEventListener('click', (e)=>{ if (e.target.matches('.removeBtn')){ const i = Number(e.target.dataset.i); cart.splice(i,1); saveCart(); } });

    // allow adding product from grid
    document.addEventListener('click', (e)=>{ if (e.target.matches('.addProductBtn')){ const id=e.target.dataset.id; const p=products.find(x=>x.id===id); cart.push({id:p.id,name:p.title,qty:1,priceUGX:p.priceUGX}); saveCart(); alert(p.title + ' added to cart'); } });

    document.getElementById('clearCartModal').addEventListener('click', ()=>{ cart=[]; saveCart(); });

    // checkout -> show invoice
    document.getElementById('checkoutBtnModal').addEventListener('click', ()=>{
      if (cart.length===0) return alert('Cart empty');
      // build invoice body
      const invBody = document.getElementById('invoiceBody'); invBody.innerHTML = '';
      const invNum = '2025-'+String(Date.now()).slice(-6);
      document.getElementById('invNumber').textContent = invNum;
      let subtotal=0;
      const tbl = document.createElement('div'); tbl.className='space-y-2';
      cart.forEach(it=>{ const row = document.createElement('div'); row.className='flex justify-between'; row.innerHTML=`<div>${it.name} x ${it.qty}</div><div>UGX ${Math.round(it.priceUGX*it.qty).toLocaleString()}</div>`; tbl.appendChild(row); subtotal += it.priceUGX*it.qty; });
      const tax = Math.round(subtotal * taxRate); const total = subtotal + tax;
      invBody.appendChild(tbl);
      const sums = document.createElement('div'); sums.className='mt-4 space-y-1'; sums.innerHTML=`<div class='flex justify-between text-sm text-gray-400'><div>Subtotal</div><div>UGX ${subtotal.toLocaleString()}</div></div><div class='flex justify-between text-sm text-gray-400'><div>Tax (18%)</div><div>UGX ${tax.toLocaleString()}</div></div><div class='flex justify-between font-bold text-lg'><div>Total</div><div>UGX ${total.toLocaleString()}</div></div>`;
      invBody.appendChild(sums);
      // show invoice modal
      document.getElementById('invoiceModal').classList.remove('hidden'); document.getElementById('invoiceModal').classList.add('flex');
    });

    // invoice actions
    document.getElementById('printInvoice').addEventListener('click', ()=>{ window.print(); });
    document.getElementById('emailInvoice').addEventListener('click', ()=>{
      // TODO: Backend later â€” for now open mailto with subject and body summary
      const to = 'williamelaihax@gmail.com';
      const subj = encodeURIComponent('New invoice from Dataphix');
      let body = 'Hello%0A%0AInvoice details:%0A%0A';
      cart.forEach(it=>{ body += encodeURIComponent(`${it.name} x ${it.qty} - UGX ${Math.round(it.priceUGX*it.qty).toLocaleString()}%0A`); });
      const subtotal = cart.reduce((s,i)=>s+i.priceUGX*i.qty,0); const tax = Math.round(subtotal*taxRate); const total = subtotal+tax;
      body += `%0ASubtotal: UGX ${subtotal.toLocaleString()}%0ATax: UGX ${tax.toLocaleString()}%0ATotal: UGX ${total.toLocaleString()}%0A%0AContact: williamelaihax@gmail.com`;
      window.location.href = `mailto:${to}?subject=${subj}&body=${body}`;
    });
    document.getElementById('closeInvoice').addEventListener('click', ()=>{ document.getElementById('invoiceModal').classList.add('hidden'); document.getElementById('invoiceModal').classList.remove('flex'); cart=[]; saveCart(); });

    // currency selector top-level affects conversion displayed prices (best-effort)
    document.getElementById('currencySelect').addEventListener('change', async (e)=>{
      const cur = e.target.value; await fetchRates('UGX'); // ensure rates
      // convert product grid labels (best-effort)
      renderProducts(products.map(p=>({...p, priceUGX:p.priceUGX}))); // keep UGX for core price; optional: show converted values
      alert('Currency set to ' + cur + '. Prices remain in UGX until checkout conversion is applied.');
    });

    // small UX: open billing with floating btn
    document.getElementById('openCartBtn').addEventListener('click', ()=>{ billingModal.classList.remove('hidden'); billingModal.classList.add('flex'); });

    // load saved cart on page load
    window.addEventListener('load', ()=>{ cart = JSON.parse(localStorage.getItem('dt_cart')||'[]'); redrawCart(); });

    // optional: queue display + loyalty placeholders
    // Queue: simple demo - shows last 3 orders from localStorage
    function showQueue(){ const qBox = document.createElement('div'); qBox.className='fixed left-6 bottom-6 z-50 p-3 glass rounded-lg text-sm text-gray-200'; qBox.innerHTML='<div class="font-semibold">Now Serving</div>'; document.body.appendChild(qBox); }
    showQueue();

  </script>

</body>
</html>
